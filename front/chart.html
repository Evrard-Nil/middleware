<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<script src="node_modules/chart.js/dist/Chart.min.js"></script>
	<script src="node_modules/chart.js/dist/Chart.js"></script>
	<script src="utils.js"></script>
	<style>
		/* Create two equal columns that floats next to each other */
		.column {
			padding: 10px;
			height: 300px; /* Should be removed. Only for demonstration */
		}

		#airport-title {
			color: #444;
			font-weight: 300;
			font-size: 1.5rem;
		}

		.row {
			-webkit-align-content: center;
			align-content: center;
			position: relative;
			height: 50%;
			width: 100%;
		}

		/* Clear floats after the columns */
		.row:after {
			content: "";
			display: table;
			clear: both;
		}

		.card {
			/* Add shadows to create the "card" effect */
			box-shadow: 0 4px 16px 0 rgba(0,0,0,0.2);
			transition: 0.3s;
		}

		/* On mouse-over, add a deeper shadow */
		.card:hover {
			box-shadow: 0 8px 32px 0 rgba(0,0,0,0.2);
		}

		/* Add some padding inside the card container */
		.container {
			padding: 2px 16px;
			margin: 10 10 10 10;
		}

		canvas{
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
		}
	</style>
</head>

<body>
	<div id="airport-title"></div>
	<div class="row">
		<div class="column" style="width: 75%; float: left;">
			<canvas id="temp-mesures"></canvas>
			<canvas id="pres-mesures"></canvas>
			<canvas id="wind-mesures"></canvas>
		</div>
		<div class="column" style="width: 20%; float: right;">
			<div class="card">
				<div class="container">
					<h4><b>Airport temperature average</b></h4> 
					<p id="temp-moyenne">12°C</p> 
				</div>
				<div class="container">
					<h4><b>Airport pressure average</b></h4> 
					<p id="pres-moyenne">12°C</p> 
				</div>
				<div class="container">
					<h4><b>Airport wind average</b></h4> 
					<p id="wind-moyenne">12°C</p> 
				</div>
			</div>
		</div>
	</div>
	

	<script>
		const http = new XMLHttpRequest()
		const baseUrl = 'localhost:8080/api/v1/'

		function getInformations() {
			var parameters = location.search.substring(1).split("&")
			var temp = parameters[0].split("=");
			temp = parameters[1].split("=");
			var airportId = unescape(temp[1]);
			var airportName = unescape(temp[1]);
			document.title = airportName + " airport charts"
			document.getElementById("airport-title").innerHTML = airportName + " airport"
		}

		function getMesures(typ) {
			var url = baseUrl + "/mesures/" + airportId + "/" + typ

			http.onreadystatechange = function () {
				if (this.readyState != 4) return;

				if (this.status == 200) {
					var data = JSON.parse(this.responseText);
					// we get the returned data
					console.log(data)
				}
				// end of state change: it can be after some time (async)
			};

			http.open("GET", baseUrl, true)
			http.send()
		}

		function getMoyenne(typ) {
			var url = baseUrl + "/moyennes/" + airportId + "/" + typ

			http.onreadystatechange = function () {
				if (this.readyState != 4) return;

				if (this.status == 200) {
					var data = JSON.parse(this.responseText);
					// we get the returned data
					console.log(data)
				}
				// end of state change: it can be after some time (async)
			};

			http.open("GET", baseUrl, true)
			http.send()
		}
		
		var MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
		var tempConfig = {
			type: 'line',
			data: {
				labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
				datasets: [{
					label: 'Temperature data',
					backgroundColor: window.chartColors.red,
					borderColor: window.chartColors.red,
					data: [
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor()
					],
					fill: false,
				}]
			},
			options: {
				responsive: true,
				title: {
					display: true,
					text: 'Temperature Chart'
				},
				tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Month'
						}
					}],
					yAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Temperature (°C)'
						}
					}]
				}
			}
		};
		var presConfig = {
			type: 'line',
			data: {
				labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
				datasets: [{
					label: 'Pressure data',
					backgroundColor: window.chartColors.blue,
					borderColor: window.chartColors.blue,
					data: [
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor()
					],
					fill: false,
				}]
			},
			options: {
				responsive: true,
				title: {
					display: true,
					text: 'Pressure Chart'
				},
				tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Month'
						}
					}],
					yAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Pressure (Pa)'
						}
					}]
				}
			}
		};

		var windConfig = {
			type: 'line',
			data: {
				labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
				datasets: [{
					label: 'Wind data',
					backgroundColor: window.chartColors.green,
					borderColor: window.chartColors.green,
					data: [
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor()
					],
					fill: false,
				}]
			},
			options: {
				responsive: true,
				title: {
					display: true,
					text: 'Wind Chart'
				},
				tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Month'
						}
					}],
					yAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Wind (°C)'
						}
					}]
				}
			}
		};
		window.onload = function() {
			getInformations()

			var ctx = document.getElementById('temp-mesures').getContext('2d');
			var tempChart = new Chart(ctx, tempConfig);
			var ctx = document.getElementById('pres-mesures').getContext('2d');
			var presChart = new Chart(ctx, presConfig);
			var ctx = document.getElementById('wind-mesures').getContext('2d');
			var windChart = new Chart(ctx, windConfig);
		};
		var colorNames = Object.keys(window.chartColors);
	</script>
</body>

</html>